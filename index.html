<html>
    <head>
        <title>Makespan</title>
        <link href="res/style.css" rel="stylesheet"/>
    </head>
    <body>
        <div class="header">
            <h1></i>Judul Skripsweet</h1>
            <p>by Aisyah Nur Rahma</p>
        </div>
        <div class="declare">
            <div class="input-group">
                <label>Job Count</label>
                <input id="jobCount" type="number" min="1" placeholder="Min Number is 1"/>
            </div>
            <div class="input-group">
                <label>Machine Count</label>
                <input id="machineCount" type="number" min="1" placeholder="Min Number is 1"/>
            </div>
            <div class="input-group">
                <label>Firefly Count</label>
                <input id="ffCount" type="number" min="1" placeholder="Min Number is 1"/>
            </div>
			<div class="input-group">
                <button id="start">Start</button>
            </div>
        </div>
        <div class="flow-input" style="display: none;">
            <h2>Input Job Flow for Each Machine</h2>
            <p class="subtitle-table">Please input the flow sequence dived by a coma (,) and new line.</p>
			<textarea id="flow"></textarea>
        </div>
        <div class="time-input" style="display: none;">
            <h2>Input Job Processing Time for Each Machine</h2>
            <p class="subtitle-table">Please input the each job time per machine dived by a coma (,) and new line.</p>
            <textarea id="timing"></textarea>
            <button id="hitung">Calculate</button>
        </div>
        <div class="result" style="display: none;">
			<h2>Inputed Variable</h2>
			<p class="subtitle-table">Variable inputed by user.</p>
			<table id="tableDeklarasi" class="deklarasi">
				<tr>
					<th class="th-2">Variable</th>
					<th class="th-8">Value</th>
				</tr>
			</table>
			
			<h2>Generated Variable</h2>
			<p class="subtitle-table">Variable generated by app.</p>
			<table id="tableGenerate" class="deklarasi">
				<tr>
					<th class="th-2">Variable</th>
					<th class="th-8">Value</th>
				</tr>
			</table>
			
        	<div class="output">
				
			</div>
        </div>
        <div class="watermark">
            <h1>Ibu/Bapak Dosen Tercintah, Lulusin aku yah</h1>
            <p>Aplikasi Ini dibuat untuk mendukung tugas akhir. Dibuat dengan penuh kasih sayang dan cinta kasih <br> pada skripsi yang telah membuat hidup kami penuh dengan cobaan.</p>
        </div>
    </body>
    <script src="res/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="main.js?v=5" type="text/javascript"></script>
    <script type="text/javascript">
        var job = 0;
        var machine = 0;
        var firefly = 0;

        var jobFlow, proses;
		
		function cT(id, title, subtitle){
			header = document.createElement('h2');
			header.innerHTML = title;
			subs   = document.createElement('p');
			subs.className = 'subtitle-table';
			subs.innerHTML = subtitle;
			
			h_var = document.createElement('th');
			h_var.className = 'th-2';
			h_var.innerHTML = 'Variable Name';
			
			h_val = document.createElement('th');
			h_val.className = 'th-8';
			h_val.innerHTML = 'Value';
			
			tr = document.createElement('tr');
			tr.appendChild(h_var);
			tr.appendChild(h_val);
			table = document.createElement('table');
			table.setAttribute('id', id);
			table.appendChild(tr);
			
			div = document.createElement('div');
			div.appendChild(header);
			div.appendChild(subs);
			div.appendChild(table);
			
			return div;
		}

        $('#start').click(function(){
//            // get all variable in first input
//            jobCount = $('#jobCount').val();
//            machineCount = $('#machineCount').val();
//            ffCount = $('#ffCount').val();
//            
//            // duplikat form input job flow
//            for(i=1; i<=parseInt(jobCount); i++){
//                label = $('<label>Job '+i+'</label>');
//                form = $('<input id="job'+i+'" type="text" placeholder="Example: 1, 3, 5, 4, 7, 2, 8, 9"/>');
//                flowGroup = $('<div class="flow-group"></div>');
//                
//                flowGroup.append(label, form);
//                $('.flow-input').append(flowGroup);
//            }
            
			// tutup hasil
			$('.result').slideUp();
			
            // tampilin form input flow
            $('.flow-input').slideDown(); 
            
            // tampilin form input time
            $('.time-input').slideDown();
        });

        $('#hitung').click(function(){
            // tutup tampilan form input
            $('.flow-input').slideUp();
            $('.time-input').slideUp();

            // ambil input dan store ke global
            job = $('#jobCount').val();
            machine = $('#machineCount').val();
            firefly = $('#ffCount').val();
			
			jobFlow = parsingInput($("#flow").val());
			proses = parsingInput($("#timing").val());

			console.log(jobFlow);
			console.log(proses);
			
			ij = 1;
			for(x in jobFlow){
				printOut('tableDeklarasi', [{ nama: 'Job '+ (ij++) +' Flow', msg: jobFlow[x].toString() }]);
			}
			
			ij = 1;
			for(x in proses){
				printOut('tableDeklarasi', [{ nama: 'Job'+ (ij++) +'/Machine Time', msg: proses[x].toString() }]);
			}
			
            // generate random number
            var numbs = generateMatriks(firefly, job * machine);
			var dTable = diskritTable(numbs, job);
			
			ij = 1;
			for(x in numbs){
				angka = new Array();
				for(y in numbs[x]){
					angka[y] = numbs[x][y].number;
				}
				msg = JSON.stringify(angka);
				$('#tableGenerate').append('<tr><td>Random Float'+(ij++)+' for firefly</td><td>'+msg+'</td>');
			}
			
			ij = 1;
			for(x in dTable){
				ffly = getDNum(dTable, x);
				msg = JSON.stringify(ffly);
				$('#tableGenerate').append('<tr><td>Firefly'+(ij)+' Diskrit</td><td>'+msg+'</td>');
				
				console.log('start');
				
				mkspan = runGantt(ffly, jobFlow, proses, machine, job);
				$('.output').append(cT('ffly'+(ij), 'Firefly '+(ij)+' Gantt', 'Gantt Chart of Generated Firefly '+(ij)+''));
				printOut('ffly'+ij	, [{ nama: 'makespan', msg: mkspan.gantt.sumTime }]);
				printOut('ffly'+ij	, [{ nama: 'Mesin ke', msg: parseInt(mkspan.mesin) + 1 }]);
				ij++;
			}
			
			$('.result').slideDown();
        });
    </script>
</html>